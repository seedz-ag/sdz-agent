#!/usr/bin/node
const fs = require('fs');
const path = require('path');
const project = path.join(__dirname, '../tsconfig.json');
const dev = fs.existsSync(project);
const { exec } = require('child_process');
const { Logger } = require('sdz-agent-common');
const yargs = require('yargs/yargs');
const { hideBin } = require('yargs/helpers');

if (dev) {
  require('ts-node').register({ project });
}

const { argv } = yargs(hideBin(process.argv));

switch (true) {
  case (argv.C || argv.config):
    require(`../src/config/config.ts`);
    break;
  case (argv.D || argv.configDto):
    require(`../src/config/dto.ts`);
    break;
  case (argv.Q || argv.query):
    const query = require(`../src/websocket/execute-query`);
    (async () => await query(argv.Q || argv.query))();
    break;
  case (argv.S || argv.schedule):
    process.env.COMMAND_LINE = true;
    require(`../src/schedule.ts`);
    break;
  case (argv.U || argv.update):
    exec("git pull", (error, stdout, stderr) => {
      Logger.info(stdout)
    });
    break
  default:
    process.env.COMMAND_LINE = argv.isWS;
    require(`../src/bootstrap.ts`);
}
